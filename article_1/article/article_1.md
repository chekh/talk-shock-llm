### Как использовать скрипты и конфигурационные файлы для запуска LLM-инфраструктуры

Эта краткое пояснение к тому, как пользоваться скриптами и конфигурационными файлами, которые мы создали, чтобы 
упростить развертывание и управление инфраструктурой LLM в контейнерах. 

---

### 1. Структура проекта и важные файлы

В директории `1. Stage` нашего проекта находятся следующие ключевые файлы и папки:

- **`docker/`** — содержит конфигурационные файлы Docker Compose и `.env` файл с переменными окружения.
  - **`docker-compose.yml`** — основной файл конфигурации для запуска и настройки контейнеров.
  - **`.env`** — файл, содержащий переменные окружения для контейнеров и путей к данным.

- **`logs/`** — папка для хранения логов работы скрипта `command.sh`.
  - **`command.log`** — файл, в который записываются все действия скрипта с указанием времени выполнения.

- **`command.sh`** — основной скрипт управления контейнерами. Он выполняет действия по запуску, остановке и управлению контейнерами.

- **`Makefile`** — файл для упрощения выполнения команд через утилиту `make`.

---

### 2. Конфигурационные файлы

#### **Файл `.env`**

Файл `.env`, находящийся в директории `docker/`, содержит переменные окружения, используемые Docker Compose. 
Он определяет пути к данным и другие параметры, необходимые для корректного запуска контейнеров. 

Вот пример его содержимого:

```env
OLLAMA_DATA_DIR=../my_ml/ollama-data
OPEN_WEBUI_DATA_DIR=../my_ml/open-webui-data
SD_MODELS_DIR=../my_ml/sd-models
SD_OUTPUT_DIR=../my_ml/sd-outputs
FLOWISE_DATA_DIR=../my_ml/flowise-data
QDRANT_DATA_DIR=../my_ml/qdrant-data
PROJECT_NAME=llm_stack
```

Эти переменные используются как Docker Compose, так и скриптом `command.sh` для настройки путей и параметров запуска.

#### **Файл `docker-compose.yml`**

Этот файл, также находящийся в директории `docker/`, описывает, какие контейнеры должны быть запущены, какие ресурсы 
они используют, и как их настроить. Он связывает контейнеры с папками на хосте, используя переменные из `.env`, 
и описывает сетевые настройки и другие параметры контейнеров.

---

### 3. Скрипт `command.sh`

Скрипт `command.sh` создан для автоматизации процесса управления контейнерами. Он позволяет запускать контейнеры, 
останавливать их, перезапускать и выводить их статус с помощью удобных команд. 

#### **Команды скрипта**

- **`./command.sh start`**
  - Команда запускает контейнеры на основе конфигурации Docker Compose.
  - Перед запуском проверяет и создаёт папки для данных (volumes), если их нет.
  - Результаты и сообщения о выполнении записываются в лог-файл `logs/command.log` с указанием времени.

- **`./command.sh stop`**
  - Останавливает все контейнеры, связанные с проектом. В лог записывается результат выполнения команды.

- **`./command.sh restart [имя_контейнера]`**
  - Перезапускает либо все контейнеры проекта, либо конкретный контейнер, если указано его имя.
  - Если имя контейнера не указано, скрипт перезапускает все контейнеры.
  - Все действия и их результаты фиксируются в лог-файле.

- **`./command.sh list`**
  - Выводит список всех контейнеров, их статусы и порты. Это полезно для мониторинга и проверки работы системы.

#### **Как работает логирование**

Каждое действие скрипта записывается в файл `logs/command.log` с указанием времени выполнения. Это упрощает мониторинг 
работы системы и диагностику проблем.

Пример записи в логе:

```
2024-10-10 12:45:22 - Запуск контейнеров через Docker Compose с проектом llm_stack...
2024-10-10 12:45:25 - Контейнеры успешно запущены
```

#### **Как добавить новый контейнер или изменить конфигурацию**

Если вы хотите добавить новый контейнер или изменить параметры существующих контейнеров:

1. Внесите изменения в файл `docker/docker-compose.yml`.
2. Если требуются новые переменные окружения или пути, добавьте их в файл `.env`.
3. Запустите скрипт `command.sh` с нужной командой (например, `./command.sh restart`), чтобы обновить и применить конфигурацию.

---

### 4. Использование Makefile

Для удобства в проекте также есть `Makefile`. Он позволяет выполнять команды проще, чем вручную вводить полные строки в терминале. Вот основные команды, доступные через Makefile:

- **`make start`** — эквивалент `./command.sh start`. Запускает контейнеры.
- **`make stop`** — эквивалент `./command.sh stop`. Останавливает контейнеры.
- **`make restart`** — эквивалент `./command.sh restart`. Перезапускает контейнеры.
- **`make list`** — эквивалент `./command.sh list`. Показывает статус контейнеров.

Это удобный способ использовать скрипт, особенно если вы привыкли к командам `make`.

---

### Заключение

Скрипт `command.sh` и конфигурационные файлы `docker/docker-compose.yml` и `.env` обеспечивают простое и гибкое 
управление LLM-инфраструктурой в контейнерах. Они автоматизируют создание окружений и управление ими, позволяя 
сосредоточиться на разработке и тестировании моделей, а не на ручной настройке контейнеров.

Используйте этот набор инструментов для быстрой развертки и управления LLM-инфраструктурой, и вы сможете эффективно 
тестировать и развивать свои проекты, минимизируя затраты времени на ручные действия.